<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZORIN | AUTHENTICATION</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Syncopate:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --bg: #ffffff; --text: #000; --accent: #000; --error: #e63946; }
        body { margin: 0; font-family: 'Cairo', sans-serif; background: var(--bg); color: var(--text); display: flex; flex-direction: column; min-height: 100vh; transition: 0.3s; }
        body.dark-mode { --bg: #000; --text: #fff; }
        
        header { padding: 20px 5%; display: flex; justify-content: center; border-bottom: 1px solid #f0f0f0; background: var(--bg); }
        .logo { font-family: 'Syncopate', sans-serif; font-size: 1.2rem; letter-spacing: 5px; cursor: pointer; color: var(--text); }

        .auth-container { flex: 1; display: flex; justify-content: center; align-items: center; padding: 20px; background: var(--bg); }
        .auth-box { width: 100%; max-width: 400px; text-align: center; }
        
        h2 { font-family: 'Syncopate'; font-size: 1rem; margin-bottom: 30px; letter-spacing: 2px; }

        .input-group { margin-bottom: 15px; text-align: left; }
        .input-group label { display: block; font-size: 10px; margin-bottom: 5px; color: #999; text-transform: uppercase; }
        .input-group input { width: 100%; padding: 12px; border: 1px solid #eee; border-radius: 5px; box-sizing: border-box; background: transparent; color: var(--text); outline: none; }
        
        .main-btn { width: 100%; padding: 15px; background: #000; color: #fff; border: none; border-radius: 5px; cursor: pointer; font-family: 'Cairo'; font-weight: bold; margin-top: 10px; }
        body.dark-mode .main-btn { background: #fff; color: #000; }

        .google-btn { width: 100%; padding: 12px; background: transparent; border: 1px solid #eee; border-radius: 5px; cursor: pointer; font-family: 'Cairo'; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 10px; color: var(--text); }
        
        .divider { margin: 20px 0; font-size: 12px; color: #999; position: relative; }
        .divider::before, .divider::after { content: ""; position: absolute; top: 50%; width: 40%; height: 1px; background: #eee; }
        .divider::before { left: 0; } .divider::after { right: 0; }

        .switch-mode { margin-top: 20px; font-size: 14px; color: #999; }
        .switch-mode span { color: var(--text); cursor: pointer; text-decoration: underline; font-weight: bold; }
        #errorMessage { color: var(--error); font-size: 12px; margin-top: 10px; display: none; }
    </style>
</head>
<body>

<header><div class="logo" onclick="location.href='index.html'">ZORIN</div></header>

<div class="auth-container">
    <div class="auth-box">
        <h2 id="title">LOGIN</h2>
        
        <div class="input-group">
            <label>Email Address</label>
            <input type="email" id="email" placeholder="email@example.com">
        </div>

        <div class="input-group">
            <label>Password</label>
            <input type="password" id="password" placeholder="••••••••">
        </div>

        <p id="errorMessage"></p>

        <button class="main-btn" onclick="handleAuth()">CONTINUE</button>

        <div class="divider">OR</div>

        <button class="google-btn" onclick="loginWithGoogle()">
            <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" width="18">
            Continue with Google
        </button>

        <div class="switch-mode" id="toggleText">
            Don't have an account? <span onclick="toggleMode(true)">Create Account</span>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCInkKv1hByxRZiHbOAfRn9bGbmaAPoZ8A",
        authDomain: "mystore-842cf.firebaseapp.com",
        projectId: "mystore-842cf",
        storageBucket: "mystore-842cf.appspot.com",
        messagingSenderId: "594163229640",
        appId: "1:594163229640:web:888670dd4016e8111656fd"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const ADMIN_EMAIL = "zorin@gmail.com";

    let isSignUp = false;

    window.toggleMode = (val) => {
        isSignUp = val;
        document.getElementById('title').innerText = isSignUp ? "CREATE ACCOUNT" : "LOGIN";
        document.getElementById('toggleText').innerHTML = isSignUp ? 
            'Already have an account? <span onclick="toggleMode(false)">Login</span>' : 
            'Don\'t have an account? <span onclick="toggleMode(true)">Create Account</span>';
    };

    async function processUser(user) {
        if (user.email === ADMIN_EMAIL) {
            location.href = 'admin.html';
        } else {
            // حفظ بيانات العميل في Firestore لو مش موجودة
            const userRef = doc(db, "users", user.uid);
            const userDoc = await getDoc(userRef);
            
            if (!userDoc.exists()) {
                await setDoc(userRef, {
                    email: user.email,
                    role: "customer",
                    createdAt: new Date(),
                    cart: [] // السلة تكون فاضية في البداية
                });
            }
            location.href = 'index.html';
        }
    }

    window.handleAuth = async () => {
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        const err = document.getElementById('errorMessage');

        try {
            const res = isSignUp ? 
                await createUserWithEmailAndPassword(auth, email, password) : 
                await signInWithEmailAndPassword(auth, email, password);
            processUser(res.user);
        } catch (e) {
            err.innerText = e.message;
            err.style.display = 'block';
        }
    };

    window.loginWithGoogle = async () => {
        const provider = new GoogleAuthProvider();
        try {
            const res = await signInWithPopup(auth, provider);
            processUser(res.user);
        } catch (e) {
            console.error(e);
        }
    };

    if(localStorage.getItem('zorin_theme') === 'dark') document.body.classList.add('dark-mode');
</script>
</body>
</html>